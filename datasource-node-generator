#!/usr/bin/env node
'use strict'

const fs = require('fs')
const path = require('path')

var readAndSave = (name, filePath, extension, directory) => {
  return new Promise(function(resolve, reject) {
    var x = "";
    fs.readFile(filePath, 'utf8', function (err,data) {
      if (err) {
        console.log("Could not find " + filePath);
        process.exit(-1)
      }
      x = x + data;

      if (!fs.existsSync('./' + directory)){
        fs.mkdirSync('./' + directory)
      }

      var savePath = path.resolve(process.cwd(), directory, name + extension) 
      fs.writeFile(savePath, x, (err) => {
        if (err) {
          console.log('Cannot create file ' + savePath)
          process.exit(-1)
        } else {
          console.log('File ' + name + extension + ' has been created in ' + directory + ' folder in current directory')
          resolve()
        }
      })
    });
  })
}

var generate = (name) => {
  if (name !== '') {

    var userPath = path.resolve(__dirname, 'template', 'routes', 'users.js');
    var indexPath = path.resolve(__dirname, 'template', 'views', 'index.pug');
    readAndSave(name, userPath, '.js', 'routes').then(() => {
      readAndSave(name, indexPath, '.pug', 'views').then(() => {
        console.log('\nAssuming that var app = express() add those two lines to your app.js (server) file:')
        console.log("\tvar " + name + " = require('./routes/" + name + "')")
        console.log("\tapp.use('/" + name  + "'," + name + ")")
      })
    })
  }
}

const program = require('commander')
program
  .version('0.0.1')
  .description('Generate express js hot controller')
  .action(generate)

program
  .parse(process.argv)

